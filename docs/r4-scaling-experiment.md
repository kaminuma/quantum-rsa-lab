# r=4 Encoded Order-Finding 実験: N=91, 143, 185 での軌道再利用

**実験日**: 2026年2月1日
**デバイス**: Rigetti Ankaa-3 (AWS Braket)
**実験者**: quantum-rsa-lab (with Claude)

---

## 概要

同一の量子回路構造（5量子ビット、8 2Qゲート）を用いて、異なる合成数 N=91, 143, 185 に対する Shor型 order-finding を実行した。全て周期 r=4 を持つ (N, a) ペアを使用し、2量子ビットに符号化された4状態軌道上で位相推定を行った。

Smolin et al. [1] の oversimplification 議論を踏まえ、r=2（コイン投げ批判の対象）ではなく r=4 の位相構造を観測する設定で評価した。ただし、本実験は依然として compiled/encoded 回路であり、汎用 Shor の実装ではない。

**重要な注意**:
- compiled/encoded 回路を使用（答えを知った上での最適化）
- r=4 となる (N, a) を意図的に選択
- 「Shor のスケーリング」ではなく「encoded r=4 orbit の target-agnostic reuse」の実証

---

## 結果サマリー

| N | 因数 | a | r | Support Mass | Hellinger | r推定 |
|---|------|---|---|--------------|-----------|-------|
| 91 | 7 × 13 | 8 | 4 | **75.3%** | 0.373 | 4 ✓ |
| 143 | 11 × 13 | 34 | 4 | **74.2%** | 0.376 | 4 ✓ |
| 185 | 5 × 37 | 6 | 4 | **73.3%** | 0.384 | 4 ✓ |

**回路スペック（全ターゲット共通）**:
- 量子ビット: 5（制御: 3, 作業: 2）
- 2Qゲート: 8（CNOT 5 + CPhaseShift 3）
- ショット数: 1000

---

## 先行研究との比較

| N | 本実験 | 先行研究 |
|---|--------|----------|
| **N=91** | Shor型 order-finding, 超伝導 | 文献調査で該当なし* |
| **N=143** | Shor型 order-finding, 超伝導 | Xu et al. (2012) [2]: 断熱量子計算 (AQC), NMR |
| **N=185** | Shor型 order-finding, 超伝導 | 文献調査で該当なし* |

*調査範囲: arXiv, Google Scholar, IEEE Xplore にて "Shor algorithm N=91/185", "quantum factoring 91/185", "order-finding superconducting" 等で検索（2012-2026年）。未公開実験や非英語文献は調査対象外。

### N=143 について

Xu et al. (2012) は N=143 の因数分解を報告しているが、手法が異なる：
- **Xu et al.**: 断熱量子計算 (AQC)、NMR システム、4量子ビット
- **本実験**: Shor型 order-finding（位相推定）、超伝導量子ビット、5量子ビット

同じ N=143 でも、**Shor型 order-finding + 超伝導デバイス**の組み合わせについては、上記調査範囲で該当する先行報告を確認できなかった。

---

## 数論的背景

### なぜ同一回路で異なる N を因数分解できるか

r=4 の場合、作業レジスタは 4 状態の巡回群を表現すればよい：

```
|a^0 mod N⟩ = |1⟩   → |00⟩
|a^1 mod N⟩ = |a⟩   → |01⟩
|a^2 mod N⟩ = |a²⟩  → |10⟩
|a^3 mod N⟩ = |a³⟩  → |11⟩
```

この符号化により、N の値に関わらず同一の制御ユニタリ構造が使える：

- **U^1**: 巡回置換 (+1 mod 4) = CNOT + Margolus gate
- **U^2**: X on work1（|00⟩↔|10⟩, |01⟩↔|11⟩）
- **U^4**: Identity（周期4なので恒等）

### 各ターゲットの数論データ

| N | a | 軌道 [1, a, a², a³] | gcd(a²-1, N) | gcd(a²+1, N) |
|---|---|---------------------|--------------|--------------|
| 91 | 8 | [1, 8, 64, 57] | 7 | 13 |
| 143 | 34 | [1, 34, 12, 122] | 11 | 13 |
| 185 | 6 | [1, 6, 36, 31] | 5 | 37 |

---

## 実験詳細

### N=91 (7 × 13)

```
Task ID: arn:aws:braket:us-west-1:...:quantum-task/bf81f5c1-119a-4901-8d5e-c29eb5cdc73d

測定結果 (1000 shots):
  010: 235 (23.5%)  ← サポート内 (位相 0.25)
  110: 232 (23.2%)  ← サポート内 (位相 0.75)
  000: 152 (15.2%)  ← サポート内 (位相 0.00)
  100: 134 (13.4%)  ← サポート内 (位相 0.50)
  111:  80 ( 8.0%)  ← ノイズ
  011:  73 ( 7.3%)  ← ノイズ
  001:  57 ( 5.7%)  ← ノイズ
  101:  37 ( 3.7%)  ← ノイズ

Support Mass: 75.3%
r推定: 位相 0.25 → 分数 1/4 → r=4 ✓

因数分解:
  8² mod 91 = 64
  gcd(64-1, 91) = gcd(63, 91) = 7
  gcd(64+1, 91) = gcd(65, 91) = 13
  ∴ 91 = 7 × 13 ✓
```

### N=143 (11 × 13)

```
測定結果 (1000 shots):
Support Mass: 74.2%
r推定: r=4 ✓

因数分解:
  34² mod 143 = 12
  gcd(12-1, 143) = gcd(11, 143) = 11
  gcd(12+1, 143) = gcd(13, 143) = 13
  ∴ 143 = 11 × 13 ✓
```

### N=185 (5 × 37)

```
測定結果 (1000 shots):
Support Mass: 73.3%
r推定: r=4 ✓

因数分解:
  6² mod 185 = 36
  gcd(36-1, 185) = gcd(35, 185) = 5
  gcd(36+1, 185) = gcd(37, 185) = 37
  ∴ 185 = 5 × 37 ✓
```

---

## 考察

### Support Mass の安定性

N=35 での先行実験（a=8, r=4）では Support Mass が 47.6% だったのに対し、今回の実験では 73-75% と大幅に改善している。これはデバイスのキャリブレーション状態の違いによる可能性が高い（実験日が異なる）。

| 実験 | 日付 | Support Mass |
|------|------|--------------|
| N=35, a=8 | 2026-01-31 | 47.6% |
| N=91, a=8 | 2026-02-01 | 75.3% |
| N=143, a=34 | 2026-02-01 | 74.2% |
| N=185, a=6 | 2026-02-01 | 73.3% |

### r=4 の意義（Smolin議論への対応）

Smolin et al. (2013) [1] は、compiled Shor 回路の oversimplification について議論し、r=2 の場合は「コイン投げと等価」になりうると指摘した。本実験では r=4 を用いることで、4状態の位相構造（0, 0.25, 0.5, 0.75）を観測する設定とした。

ただし、r=4 であっても compiled/encoded である限り、Smolin の指摘する本質的問題（modexp のスケーリングコストが回路に反映されない）は残る。本実験は「正当な Shor」を主張するものではなく、encoded orbit 上での位相推定が実機で観測可能であることを示すものである。

### 統計的有意性

Support Mass の一様分布基準（50%）に対する有意性：

| N | Support Mass | 一様基準との差 | 統計的有意性 |
|---|--------------|---------------|-------------|
| 91 | 75.3% | +25.3pp | z ≈ 16, p ≪ 10⁻¹⁰ |
| 143 | 74.2% | +24.2pp | z ≈ 15, p ≪ 10⁻¹⁰ |
| 185 | 73.3% | +23.3pp | z ≈ 15, p ≪ 10⁻¹⁰ |

※ 1000 shots、binomial test。全ターゲットで一様分布を有意に上回っている。

### 本実験の意味：Encoded Orbit の再利用性

本実験が示したのは「N のスケーリング（一般の因数分解能力の拡大）」ではなく、**encoded r=4 orbit の target-agnostic reuse** である：

- 回路複雑度は N の桁数ではなく r（軌道サイズ）で決まる
- r=4 の軌道を 2 qubit に符号化することで、異なる N でも同じ controlled-U 構造が使える
- 実機で Support Mass が 73-75% 程度で揃う（同日・同深さ・同2Q数）

これは compiled 回路設計の「再利用可能性」を示すものであり、汎用 Shor のスケーリングとは異なる。

---

## 限界と制約

1. **Compiled/Encoded 回路**: 答えを知った上で最適化した回路であり、汎用 Shor ではない。Smolin の指摘する本質的問題（modexp コストが消える）は依然として該当する
2. **r=4 の選択**: 「都合の良い」周期を持つ (N, a) を意図的に選択。これは「Nのスケーリング」ではなく「同一軌道構造の再利用」
3. **デバイス状態の変動**: 日によって Support Mass が大きく変動する（N=35 での 47.6% → 今回の 73-75% は同一回路でも日付が異なる）
4. **単一 rep**: 各 N について 1 回のみの実行。reps=5 程度の追試で「現象」として確立する必要がある
5. **キャリブレーション情報の欠如**: Braket から返されるデバイス指標（2Q error rate 等）をログに含めていない

---

## 再現方法

```bash
# シミュレーション
python scripts/run_r4_scaling_experiments.py --simulate

# 実機実行（AWS認証が必要）
python scripts/run_r4_scaling_experiments.py --shots 1000

# 特定の N のみ
python scripts/run_r4_scaling_experiments.py --target 91 --shots 1000
```

---

## 参考文献

[1] J. A. Smolin, G. Smith, and A. Vargo, "Oversimplifying quantum factoring," Nature, vol. 499, pp. 163-165, 2013.

[2] N. Xu et al., "Quantum Factorization of 143 on a Dipolar-Coupling Nuclear Magnetic Resonance System," Phys. Rev. Lett. 108, 130501, 2012. https://arxiv.org/abs/1111.3726

---

*作成日: 2026年2月1日*
*AIアシスタント（Claude）との対話を通じて実験・執筆*
